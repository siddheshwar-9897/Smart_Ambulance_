{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-3">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 bg-light p-3 shadow-sm rounded" id="sidebar">
      <h5 class="text-primary text-center mb-3">
        <i class="bi bi-speedometer2 me-2"></i>Dashboard
      </h5>
      <ul class="nav flex-column" id="sidebarMenu">
        <li class="nav-item mb-2">
          <a href="#" id="homeLink" class="nav-link text-dark fw-semibold">
            <i class="bi bi-house me-2"></i>Home
          </a>
        </li>
        
        <!-- Police Only Features -->
        <li class="nav-item mb-2 police-only" style="display: none;">
          <a href="#" id="mapLink" class="nav-link text-dark fw-semibold">
            <i class="bi bi-map me-2"></i>Live Map
          </a>
        </li>
        <li class="nav-item mb-2 police-only" style="display: none;">
          <a href="#" id="alertsLink" class="nav-link text-dark fw-semibold">
            <i class="bi bi-bell me-2"></i>Active Alerts
          </a>
        </li>
        
        <!-- Ambulance Only Features -->
        <li class="nav-item mb-2 ambulance-only" style="display: none;">
          <a href="#" id="startAlertLink" class="nav-link text-dark fw-semibold">
            <i class="bi bi-plus-circle me-2"></i>Start Alert
          </a>
        </li>
        <li class="nav-item mb-2 ambulance-only" style="display: none;">
          <a href="#" id="updateLocationLink" class="nav-link text-dark fw-semibold">
            <i class="bi bi-geo-alt me-2"></i>Update Location
          </a>
        </li>
        
        <!-- Common -->
        <li class="nav-item mb-2">
          <a href="#" id="logoutBtn" class="nav-link text-danger fw-semibold">
            <i class="bi bi-box-arrow-right me-2"></i>Logout
          </a>
        </li>
      </ul>
      
      <!-- User Info Card -->
      <div class="card mt-4">
        <div class="card-body text-center p-3">
          <div class="mb-2">
            <i class="bi bi-person-circle display-6 text-primary"></i>
          </div>
          <h6 id="sidebarUserName" class="card-title mb-1">User</h6>
          <span class="badge bg-primary" id="sidebarUserRole">Role</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 col-lg-10" id="mainContent">
      <!-- Welcome Section -->
      <div id="welcomeSection" class="p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h3 class="text-primary mb-1">Welcome, <span id="userName" class="text-success"></span>! ðŸ‘‹</h3>
            <p class="text-muted mb-0">Role: <span class="badge bg-info" id="userRole"></span></p>
          </div>
          <div class="text-end">
            <div class="fw-semibold" id="currentTime"></div>
            <small class="text-muted" id="currentDate"></small>
          </div>
        </div>
        
        <!-- Role-based Quick Stats -->
        <div class="row mb-4" id="quickStats">
          <!-- Stats will be populated based on role -->
        </div>
        
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          Use the sidebar to navigate through available features for your role.
        </div>
      </div>

      <!-- Police: Map Section -->
      <div id="mapSection" class="p-3" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="text-primary mb-0">
            <i class="bi bi-map me-2"></i>Live Ambulance Locations
          </h4>
          <button id="refreshMapBtn" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>
        <div id="map" class="map-container" style="height:500px; border-radius:10px;"></div>
        <div class="mt-3">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            Showing real-time locations of active ambulance alerts
          </small>
        </div>
      </div>

      <!-- Police: Alerts Section -->
      <div id="alertsSection" class="p-4" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="text-primary mb-0">
            <i class="bi bi-bell me-2"></i>Active Emergency Alerts
          </h4>
          <button id="refreshAlertsBtn" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>
        
        <div class="table-responsive">
          <table class="table table-bordered table-striped table-hover">
            <thead class="table-primary">
              <tr>
                <th>Alert ID</th>
                <th>Driver</th>
                <th>Vehicle</th>
                <th>Status</th>
                <th>Start Time</th>
                <th>Origin</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="alertsTableBody">
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  <i class="bi bi-hourglass-split display-4 d-block mb-2"></i>
                  Loading alerts...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ambulance: Start Alert Section -->
      <div id="startAlertSection" class="p-4" style="display:none;">
        <h4 class="text-primary mb-4">
          <i class="bi bi-plus-circle me-2"></i>Start Emergency Alert
        </h4>
        <!-- Form will be loaded dynamically -->
        <div id="startAlertFormContainer"></div>
      </div>

      <!-- Ambulance: Update Location Section -->
      <div id="updateLocationSection" class="p-4" style="display:none;">
        <h4 class="text-primary mb-4">
          <i class="bi bi-geo-alt me-2"></i>Update Your Location
        </h4>
        <!-- Form will be loaded dynamically -->
        <div id="updateLocationFormContainer"></div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Leaflet for maps (free alternative to Google Maps) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="{{ url_for('static', path='js/dashboard.js') }}"></script>
{% endblock %}